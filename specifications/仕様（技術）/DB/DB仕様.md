# DBについて

## テーブル定義

- [ ] `エンティティ`フォルダにあるエンティティがテーブルのイメージで、それをを元にテーブルを作成

## パフォーマンス

- [ ] `pg_trgm`を使うなどする

    ```sql
    CREATE EXTENSION pg_trgm;
    CREATE INDEX idx_column_trgm ON your_table USING gin(column_name gin_trgm_ops);
    ```

## 検討したこと

- 検索用の非正規化したデータを格納するテーブルをいくつか作り、そこに対して全文検索をかけるようにする
- そもそも検索なのでSQL又はそれに準ずるものでDBに問い合わせる必要があり、基本的にはあまりコードを介してはならないはずなので、高度な機械学習による類似度判定は使えない
  - ベクトルデータにすれば類似度判定がDBに閉じるけれども、そういうのは画像とか曖昧な文章とかに向いてるだけで、コード進行をベクトルデータにしても精度がよくない（いい精度を出すには独自のchord2vecを作る必要があり、面倒。多分無理）。そもそもchord2vecを作るにしても内部実装は重み付けとかで頑張る必要がありそうで、そういう頑張りをするなら結局DBに非正規化した文字列カラムをいくつか作ってそれらから検索しても同じような頑張りなのではと思える
- `2222555511116666 みたいな長いコード進行も「2516」で検索引っかかるようにしたい件`
  - かといって4444444411116666のDBに入れるデータを「416」とかにしたら「1416」と検索しても引っかかっちゃうからそういうのは嫌だなどうすればいいか
  な
  - `結論:` いやこういうのはそもそも2516で登録すればいいのでは？
- Q: 検索系テーブル、ハッシュテーブル的なNoSQLでは駄目なの？
  - A: 要件的に無理っぽい。工夫すればできるのかな…？
