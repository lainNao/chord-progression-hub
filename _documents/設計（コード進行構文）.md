# コード進行構文の定義

## 構文（大体の雰囲気掴む用の簡略版正規表現）

全体（簡略表現）

```regexp
/|((メタ情報)?コード|)+/
```

全体（詳細）

```regexp
/|((key=調性)?コード|)+/
```

メタ情報

```regexp
/key=調性/
```

調整

```regexp
/(音階名)(m)?/
```

コード

```regexp
/(コード(/分母)?)
```

分母

```regexp
コードか、単に単音かでもどちらでも
```

## ChatGPTに投げる仕様

以下のような構文のコード進行のlexer、parser、それを利用するサンプルコードをRustで作ってください。

```構文
セクション
```

セクションの構文は以下です。

- 空行を挟んで複数のセクションを定義できます。
- 一つのセクションの構文は以下です。

  ```構文
  セクションメタ情報
  セクション
  ```

- セクションメタ情報とコードブロックの間には一つの空行を挟まないといけません。
- セクションメタ情報の構文は以下です。

  ```構文
  (メタ情報=値)
  ```

  - `(メタ情報=値)`の部分の構文は以下です。
    - 省略可能です。
    - 連続して複数定義できます。
    - `(`、`メタ情報`、`=`、`値`、`)`の間には空白を入れても問題ありません。
    - セクションメタ情報で取りうるメタ情報の種類は今は以下の通りですが、後々拡張しやすいようにしたいです。
      - `section`
        - 取りうる値は任意の文字列です。
        - 例: `section=verse`
        - 一つのセクションメタ情報につき、最大一つまで定義できます。
- セクションは、複数のコードブロックの連続です。
  - ただし、コードブロックが改行を挟まずに連続する場合、その間のパイプ（`|`）は連続で二重にならずに一つだけである必要があります。改行を挟む場合は、パイプはまた必要です。

  ```例
  |(メタ情報=値)コード|コード|コード|
  |コード|コード|コード|コード|
  ```

- コードブロックの構文は以下です。

  ```構文
  |(メタ情報=値)コード|
  ```

  - `(メタ情報=値)`の部分の構文は以下です。
    - 省略可能です。
    - 連続して複数定義できます。
    - `(`、`メタ情報`、`=`、`値`、`)`の間には空白を入れても問題ありません。`(メタ情報=値)`と`コード`の間にも空白を入れても問題ありません。
    - コードブロックのメタ情報の種類は今は以下の通りですが、後々拡張しやすいようにしたいです。
    - `key`
      - 取りうる値は後述します。（※1）
      - 例: `key=verse`
      - 一つのセクションメタ情報につき、最大一つまで定義できます。
- コードの種類は後述します。（※2）
- `(メタ情報=値)コード`の部分はカンマ区切りで複数指定可能です。カンマの後は半角スペースがあっても問題ありません。

  ```構文
  |(メタ情報=値)コード, コード, (メタ情報=値)コード, コード|
  ```

補足

- （※1）`key`が取りうる値
  - `大文字A〜Gのいずれかの音階名`に任意で`m`をつけたものです。
  - 例:
    - Cb
    - Cbm
    - C
    - Cm
    - C#
    - C#m
    - Eb
    - Ebm
    - E
    - Em
    - F
    - Fb
    - Fbm
    - Fm
    - F#
    - F#m
    - Gb
    - Gbm
    - G
    - Gm
    - G#
    - G#m
    - Ab
    - Abm
    - A
    - Am
    - A#
    - A#m
    - Bb
    - Bbm
    - B
    - Bm
  - 現状は上記だけですが、後々拡張しやすいようにしたいです。
- （※2）コードの種類
  - `大文字A〜Gのいずれかの音階名`に任意で`#かb`をつけ、その後ろに任意で`mかMかaugかdimかaddかsus2かsus4`をつけ、その後ろに任意で`2か3かb3か4かb5か-5か5か#5かb6か6か7か7-5かb9か9か#9かb11か11か#11かb13か13か#13`をつけたものです。
  - なお、わからない場合もあると思うので「?」も許容します。
